# SatSwarmv2 Simulation & Testing

This directory contains the simulation environment for SatSwarmv2, organized into logical subcomponents.

## Directory Structure

| Directory | Contents |
|-----------|----------|
| `sv/`     | SystemVerilog testbenches and test modules (e.g., `tb_verisat.sv`) |
| `cpp/`    | C++ simulation wrappers for Verilator (e.g., `sim_main.cpp`) |
| `scripts/`| Shell and Python scripts for automation and benchmarking |
| `obj_dir/`| Build artifacts (generated by Verilator) |

## Quick Start

You can run these commands from this directory (`sim/`). The `Makefile` handles path resolution.

```bash
# Build the simulator
make build

# Run the standard test suite
make test

# Run with debug output on 8-variable problems
make debug_8v

# Run benchmarking scripts
./scripts/run_benchmarks.sh
```

## Makefile Targets

| Target | Description |
|--------|-------------|
| `make build` | Compile SatSwarmv2 with Verilator using files in `sv/` and `cpp/` |
| `make test` | Build and run the full test suite |
| `make benchmark` | Run benchmarks and save results |
| `make wave` | Build with waveform tracing enabled` |
| `make debug_single` | Test single-core solver in isolation |
| `make debug_8v` | Debug on 8-variable UNSAT instances with trace logging |
| `make clean` | Remove `obj_dir`, logs, and other artifacts |

## Scripts

All scripts are located in `scripts/`, but are designed to be run from anywhere (they auto-detect paths).

- **`scripts/run_benchmarks.sh`**: Comprehensive benchmark runner.
- **`scripts/quick_test.sh`**: Fast regression test for specific instances.
- **`scripts/test_focused_satlib.sh`**: Tests 3 smallest SAT + 3 smallest UNSAT instances.
- **`scripts/test_unsat_instances.sh`**: Targeted UNSAT testing.
- **`scripts/benchmark_scale.py`**: Python-based scalability vs hardware comparison.
- **`scripts/gen_trace.py`**: Generates Python reference traces.

## Testbenches (in `sv/`)

- **`tb_verisat.sv`**: Main top-level testbench.
- **`tb_8v_debug.sv`**: Debug testbench for 8-variable problems.
- **`tb_regression_single.sv`**: Single-core regression testbench (supports dynamic CNF loading).
- **`tb_single_core_debug.sv`**: Single-core isolation testbench.
- **`test_*.sv`**: Individual test case wrappers.

## Regression Strategy

For robust solver development, follow this "ladder" testing strategy:

1.  **Test Progressively**: Start with the smallest problems (e.g., 3-variable) and move to larger ones.
2.  **Debug Smallest First**: If a failure occurs, always debug the *smallest identifiable failing case*. Small cases produce shorter traces and are much easier to root-cause.
3.  **Run the Ladder**: Use `scripts/run_ladder_tests.sh` to automatically run tests in ascending order of variable count. It will stop at the first failure.

## New Verification Scripts

- **`scripts/run_cnf.sh <file.cnf> [SAT|UNSAT]`**: Run a specific CNF file through the simulator.
- **`scripts/verify_quick.sh`**: Run the standard regression suite.
- **`scripts/verify_thorough.sh`**: Run standard regression + 50 random small tests.
- **`scripts/verify_full.sh`**: Run standard regression + ALL 800+ small tests.
- **`scripts/run_ladder_tests.sh`**: Run all small tests grouped by variable size (3v, 4v, 5v...), stopping on the first failure.

## C++ Wrappers (in `cpp/`)

- **`sim_main.cpp`**: Main C++ entry point for Verilator.
- **`sim_single_core.cpp`**: Wrapper for single-core debug.
- **`sim_8v_debug.cpp`**: Wrapper for 8v debug.

## Logging

All simulation and testing scripts automatically write their output to the `sim/logs/` directory. Each run creates a new, timestamped log file (e.g., `verify_quick_20260113_120000.log`) to preserve history and avoid overwriting previous results.


